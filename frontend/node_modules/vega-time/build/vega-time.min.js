!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("d3-time"),require("d3-time-format"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","vega-util","d3-time","d3-time-format","d3-array"],t):t((e=e||self).vega={},e.vega,e.d3,e.d3,e.d3)}(this,(function(e,t,n,r,i){"use strict";const o="year",u="quarter",c="month",a="week",s="date",f="day",l="hours",m="minutes",d="seconds",g="milliseconds",M=[o,u,c,a,s,f,l,m,d,g].reduce((e,t,n)=>(e[t]=1+n,e),{});function h(e){const n=t.array(e).slice(),r={};return n.length||t.error("Missing time unit."),n.forEach(e=>{t.hasOwnProperty(M,e)?r[e]=1:t.error(`Invalid time unit: ${e}.`)}),(r[a]||r[f])&&(r[u]||r[c]||r[s])&&t.error(`Incompatible time units: ${e}`),n.sort((e,t)=>M[e]-M[t]),n}const y=new Date;function D(e,n,r,i){const M=n||1,h=t.peek(e),y=(e,t,n)=>(function(e,t,n){return t<=1?e:n?(r,i)=>n+t*Math.floor((e(r,i)-n)/t):(n,r)=>t*Math.floor(e(n,r)/t)})(r[n||e],e===h&&M,t),D=new Date,U=t.toSet(e),T=U[o]?y(o):t.constant(2012),p=U[c]?y(c):U[u]?y(u):t.zero,C=U[a]&&U[f]?y(f,1,a+f):U[a]?y(a,1):U[f]?y(f,1):U[s]?y(s,1):t.one,v=U[l]?y(l):t.zero,F=U[m]?y(m):t.zero,S=U[d]?y(d):t.zero,Y=U[g]?y(g):t.zero;return function(e){D.setTime(+e);const t=T(D);return i(t,p(D),C(D,t),v(D),F(D),S(D),Y(D))}}function U(e,t,n){return t+7*e-(n+6)%7}const T={[o]:e=>e.getFullYear(),[u]:e=>3*~~(e.getMonth()/3),[c]:e=>e.getMonth(),[s]:e=>e.getDate(),[l]:e=>e.getHours(),[m]:e=>e.getMinutes(),[d]:e=>e.getSeconds(),[g]:e=>e.getMilliseconds(),[f]:(e,t)=>U(1,e.getDay(),v(t)),[a]:(e,t)=>U(C(e),0,v(t)),[a+f]:(e,t)=>U(C(e),e.getDay(),v(t))};function p(e){return y.setFullYear(e),y.setMonth(0),y.setDate(1),y.setHours(0,0,0,0),y}function C(e){return n.timeWeek.count(p(e.getFullYear())-1,e)}function v(e){return p(e).getDay()}function F(e,t,n,r,i,o,u){if(0<=e&&e<100){var c=new Date(-1,t,n,r,i,o,u);return c.setFullYear(e),c}return new Date(e,t,n,r,i,o,u)}const S={[o]:e=>e.getUTCFullYear(),[u]:e=>3*~~(e.getUTCMonth()/3),[c]:e=>e.getUTCMonth(),[s]:e=>e.getUTCDate(),[l]:e=>e.getUTCHours(),[m]:e=>e.getUTCMinutes(),[d]:e=>e.getUTCSeconds(),[g]:e=>e.getUTCMilliseconds(),[f]:(e,t)=>U(1,e.getUTCDay(),b(t)),[a]:(e,t)=>U(Y(e),0,b(t)),[a+f]:(e,t)=>U(Y(e),e.getUTCDay(),b(t))};function Y(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return n.utcWeek.count(t-1,e)}function b(e){return y.setTime(Date.UTC(e,0,1)),y.getUTCDay()}function $(e,t,n,r,i,o,u){if(0<=e&&e<100){var c=new Date(Date.UTC(-1,t,n,r,i,o,u));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(e,t,n,r,i,o,u))}const k={[o]:n.timeYear,[u]:n.timeMonth.every(3),[c]:n.timeMonth,[a]:n.timeWeek,[s]:n.timeDay,[f]:n.timeDay,[l]:n.timeHour,[m]:n.timeMinute,[d]:n.timeSecond,[g]:n.timeMillisecond},q={[o]:n.utcYear,[u]:n.utcMonth.every(3),[c]:n.utcMonth,[a]:n.utcWeek,[s]:n.utcDay,[f]:n.utcDay,[l]:n.utcHour,[m]:n.utcMinute,[d]:n.utcSecond,[g]:n.utcMillisecond};function w(e){return k[e]}function x(e){return q[e]}function H(e,t,n){return e?e.offset(t,n):void 0}function I(e,t,n,r){return e?e.range(t,n,r):void 0}const z={[o]:"%Y ",[u]:"Q%q ",[c]:"%b ",[s]:"%d ",[a]:"W%U ",[f]:"%a ",[l]:"%H:00",[m]:"00:%M",[d]:":%S",[g]:".%L",[`${o}-${c}`]:"%Y-%m ",[`${o}-${c}-${s}`]:"%Y-%m-%d ",[`${l}-${m}`]:"%H:%M"};function O(e,n,r){return t.isString(r)?e(r):function(e,n,r){r=r||{},t.isObject(r)||t.error(`Invalid time multi-format specifier: ${r}`);const i=n(d),M=n(m),h=n(l),y=n(s),D=n(a),U=n(c),T=n(u),p=n(o),C=e(r[g]||".%L"),v=e(r[d]||":%S"),F=e(r[m]||"%I:%M"),S=e(r[l]||"%I %p"),Y=e(r[s]||r[f]||"%a %d"),b=e(r[a]||"%b %d"),$=e(r[c]||"%B"),k=e(r[u]||"%B"),q=e(r[o]||"%Y");return function(e){return(i(e)<e?C:M(e)<e?v:h(e)<e?F:y(e)<e?S:U(e)<e?D(e)<e?Y:b:p(e)<e?T(e)<e?$:k:q)(e)}}(e,n,r)}const W=31536e6,j=[o,c,s,l,m,d,g],B=j.slice(0,-1),L=B.slice(0,-1),P=L.slice(0,-1),_=P.slice(0,-1),E=[o,c],Q=[o],A=[[B,1,1e3],[B,5,5e3],[B,15,15e3],[B,30,3e4],[L,1,6e4],[L,5,3e5],[L,15,9e5],[L,30,18e5],[P,1,36e5],[P,3,108e5],[P,6,216e5],[P,12,432e5],[_,1,864e5],[[o,a],1,6048e5],[E,1,2592e6],[E,3,7776e6],[Q,1,W]];e.timeBin=function(e){const n=e.extent,r=e.maxbins||40,o=Math.abs(t.span(n))/r;let u,c,a=i.bisector(e=>e[2]).right(A,o);return a===A.length?(u=Q,c=i.tickStep(n[0]/W,n[1]/W,r)):a?(u=(a=A[o/A[a-1][2]<A[a][2]/o?a-1:a])[0],c=a[1]):(u=j,c=Math.max(i.tickStep(n[0],n[1],r),1)),{units:u,step:c}},e.timeFloor=function(e,t){return D(e,t||1,T,F)},e.timeFormat=function(e){return O(r.timeFormat,w,e)},e.timeInterval=w,e.timeOffset=function(e,t,n){return H(w(e),t,n)},e.timeSequence=function(e,t,n,r){return I(w(e),t,n,r)},e.timeUnitSpecifier=function(e,n){const r=t.extend({},z,n),i=h(e),o=i.length;let u,c,a="",s=0;for(s=0;s<o;)for(u=i.length;u>s;--u)if(null!=r[c=i.slice(s,u).join("-")]){a+=r[c],s=u;break}return a.trim()},e.timeUnits=h,e.utcFloor=function(e,t){return D(e,t||1,S,$)},e.utcFormat=function(e){return O(r.utcFormat,x,e)},e.utcInterval=x,e.utcOffset=function(e,t,n){return H(x(e),t,n)},e.utcSequence=function(e,t,n,r){return I(x(e),t,n,r)},Object.defineProperty(e,"__esModule",{value:!0})}));